# Revert

## **描述**

给定一个或多个现有提交，恢复相关提交引入的更改，并记录一些这些更改的新提交。这就要求工作树是干净的（没有来自头部的修改）

将现有的提交还原，恢复提交的内容，并生成一条还原记录。

## **应用场景**

应用场景：有一天测试突然跟你说，开发上线的功能有问题，需要马上撤回，否则会影响到系统使用。这时可能会想到用 reset 回退，可是看了看分支上最新的提交还有其他同事的代码，用 reset 会把这部分代码也撤回了。由于情况紧急，又想不到好方法，还是任性的使用 reset，然后再让同事把他的代码合一遍（同事听到想打人），于是你的技术形象在同事眼里一落千丈

## **命令使用**

### **revert 普通提交**

学会 revert 之后，立马就可以拯救这种尴尬的情况。

现在 master 记录如下：

```bash
git revert 21dcd937fe555f58841b17466a99118deb489212
```

revert 掉自己提交的 commit

### **revert 合并提交**

在 git 的 commit 记录里，还有一种类型是合并提交，想要 revert 合并提交，使用上会有些不一样。

官方：通常无法 revert 合并，因为您不知道合并的哪一侧应被视为主线。此选项指定主线的父编号（从1开始），并允许 revert 反转相对于指定父编号的更改

合并提交是两条分支的交集节点，而 git 不知道需要撤销的哪一条分支，需要添加参数 -m 指定主线分支，保留主线分支的代码，另一条则被撤销。



-m 后面要跟一个 parent number 标识出"主线"，一般使用 1 保留主分支代码。

```bash
git revert -m 1 <commitHash>
```

### **revert 合并提交后，再次合并分支会失效**

还是上面的场景，在 master 分支 revert 合并提交后，然后切到 feature 分支修复好 bug，再合并到 master 分支时，会发现之前被 revert 的修改内容没有重新合并进来。

因为使用 revert 后， feature 分支的 commit 还是会保留在 master 分支的记录中，当再次合并进去时，git 判断有相同的 commitHash，就忽略了相关 commit 修改的内容。

这时就需要 revert 掉之前 revert 的合并提交，有点拗口

